<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CanchaYa-Torneos</title>
    <link rel="stylesheet" href="dise√±oTorneo.css">
</head>
<body>
<header>
    <nav>
        <div class="logo">‚öΩ Torneos</div>
        <ul class="nav-links">
            <li><a onclick="showSection('inicio')">Inicio</a></li>
            <li><a onclick="showSection('torneos')">Ver Torneos</a></li>
        </ul>
    </nav>
</header>

<div class="hero">
    <h1>TORNEOS - CANCHAYA</h1>
    <p>Aqu√≠ encontrar√°s las reglas e instrucciones para hacer tu torneo </p>
</div>

<div class="container">
    <!-- Secci√≥n Inicio -->
    <div id="inicio-section" class="section">
        <h2> ¬øComo crear tu torneo? </h2>
        <p style="color: #e5e7eb; font-size: 1.2rem; line-height: 1.8;">
            Con este boton podras entrar a la seccion de crear torneos,
            donde podras llenar un formulario con los datos necesarios para crear tu torneo.
            <br><br>
            <button class="nav-style-btn" onclick="showSection('crear')">Crear Torneo</button>
            <br><br>
        </p>
        <h2>
            ¬øComo inscribir un equipo a un torneo?
        </h2>
        <p style="color: #e5e7eb; font-size: 1.2rem; line-height: 1.8;">
            En la seccion de ver torneos, podras ver todos los torneos disponibles.
            <br><br>
            Cada torneo tendra un boton de "Inscribir Equipo", al darle click se abrira un modal
            donde podras llenar un formulario con los datos del equipo que deseas inscribir.
            <br><br>
            Una vez inscrito el equipo, podras ver el equipo en la lista de equipos inscritos del torneo.
        </p>
    </div>

    <!-- Secci√≥n Crear Torneo -->
    <div id="crear-section" class="section hidden">
        <h2>Crear Nuevo Torneo</h2>
        <div id="crear-message" class="message"></div>

        <form id="crear-torneo-form">
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombre-torneo">Nombre del Torneo *</label>
                    <input type="text" id="nombre-torneo" required placeholder="Ej: Copa Pati√±o 2025">
                </div>

                <div class="form-group">
                    <label for="fecha-inicio">Fecha de Inicio *</label>
                    <input type="date" id="fecha-inicio" required>
                </div>

                <div class="form-group">
                    <label for="fecha-fin">Fecha de Finalizaci√≥n *</label>
                    <input type="date" id="fecha-fin" required>
                </div>

                <div class="form-group">
                    <label for="num-equipos">N√∫mero de Equipos *</label>
                    <select id="num-equipos" required>
                        <option value="">Selecciona...</option>
                        <option value="8">8 equipos</option>
                        <option value="16">16 equipos</option>
                        <option value="32">32 equipos</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="costo">Costo de Inscripci√≥n *</label>
                    <input type="number" id="costo" required placeholder="Ej: 150000" min="0">
                </div>

                <div class="form-group">
                    <label for="ubicacion">Ubicaci√≥n *</label>
                    <input type="text" id="ubicacion" required placeholder="Ej: Sede Norte">
                </div>
            </div>

            <div class="form-group">
                <label for="descripcion">Descripci√≥n del Torneo</label>
                <textarea id="descripcion" placeholder="Describe los detalles del torneo..."></textarea>
            </div>

            <button type="submit" class="btn">Crear Torneo</button>
        </form>
    </div>

    <!-- Secci√≥n Ver Torneos -->
    <div id="torneos-section" class="section hidden">
        <h2>Torneos Disponibles</h2>
        <div id="torneos-message" class="message"></div>
        <div id="torneos-grid" class="torneos-grid"></div>
    </div>
</div>

<!-- Modal de Inscripci√≥n -->
<div id="inscripcion-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Inscribir Equipo</h2>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>

        <div id="modal-message" class="message"></div>

        <form id="inscripcion-form">
            <div class="form-group">
                <label for="nombre-equipo">Nombre del Equipo *</label>
                <input type="text" id="nombre-equipo" required placeholder="Ej: Chatarritas FC">
            </div>

            <div class="form-group">
                <label for="nombre-capitan">Nombre del Capit√°n *</label>
                <input type="text" id="nombre-capitan" required placeholder="Ej: Yeison">
            </div>

            <div class="form-group">
                <label for="telefono">Tel√©fono de Contacto *</label>
                <input type="tel" id="telefono" required placeholder="Ej: 3182529283">
            </div>

            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" required placeholder="Ej: equipo@ejemplo.com">
            </div>

            <button type="submit" class="btn">Confirmar Inscripci√≥n</button>
        </form>
    </div>
</div>

<!-- Modal de Ver Equipos -->
<div id="equipos-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Equipos Inscritos</h2>
            <button class="close-btn" onclick="closeEquiposModal()">&times;</button>
        </div>
        <div id="equipos-list" class="equipos-list"></div>
    </div>
</div>

<script>
    // Configuraci√≥n de la API - CAMBIA ESTO POR TU URL DE RAILWAY
    const API_URL = window.location.origin + '/api'; // Para desarrollo local
    // const API_URL = 'https://tu-app.railway.app/api'; // Para producci√≥n en Railway

    // Variables globales
    let torneoSeleccionado = null;

    // Mostrar secciones
    function showSection(section) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById(`${section}-section`).classList.remove('hidden');

        if (section === 'torneos') {
            cargarTorneos();
        }
    }

    // ========== CREAR TORNEO ==========
    document.getElementById('crear-torneo-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const nombreTorneo = document.getElementById('nombre-torneo').value;
        const fechaInicio = document.getElementById('fecha-inicio').value;
        const fechaFin = document.getElementById('fecha-fin').value;
        const numEquipos = document.getElementById('num-equipos').value;
        const costo = document.getElementById('costo').value;
        const ubicacion = document.getElementById('ubicacion').value;
        const descripcion = document.getElementById('descripcion').value;

        // Validaci√≥n de fechas
        if (new Date(fechaFin) <= new Date(fechaInicio)) {
            showMessage('crear-message', 'La fecha de finalizaci√≥n debe ser posterior a la fecha de inicio', 'error');
            return;
        }

        const torneo = {
            nombre: nombreTorneo,
            fechaInicio,
            fechaFin,
            numEquipos: parseInt(numEquipos),
            costo: parseFloat(costo),
            ubicacion,
            descripcion
        };

        try {
            const response = await fetch(`${API_URL}/torneos`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(torneo)
            });

            const data = await response.json();

            if (response.ok) {
                showMessage('crear-message', data.mensaje, 'success');
                this.reset();

                setTimeout(() => {
                    showSection('torneos');
                }, 2000);
            } else {
                showMessage('crear-message', data.error || 'Error al crear el torneo', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showMessage('crear-message', 'Error de conexi√≥n con el servidor', 'error');
        }
    });

    // ========== CARGAR TORNEOS ==========
    async function cargarTorneos() {
        const grid = document.getElementById('torneos-grid');

        try {
            const response = await fetch(`${API_URL}/torneos`);
            const torneos = await response.json();

            if (torneos.length === 0) {
                grid.innerHTML = '<p style="color: #e5e7eb; text-align: center; grid-column: 1/-1;">No hay torneos disponibles a√∫n. ¬°Crea el primero!</p>';
                return;
            }

            grid.innerHTML = torneos.map(torneo => `
                    <div class="torneo-card">
                        <h3>${torneo.nombre}</h3>
                        <div class="torneo-info">
                            <strong>üìÖ Inicio:</strong> ${formatDate(torneo.fechaInicio)}
                        </div>
                        <div class="torneo-info">
                            <strong>üèÅ Fin:</strong> ${formatDate(torneo.fechaFin)}
                        </div>
                        <div class="torneo-info">
                            <strong>üë• Equipos:</strong> ${torneo.equiposInscritos.length}/${torneo.numEquipos}
                        </div>
                        <div class="torneo-info">
                            <strong>üìç Ubicaci√≥n:</strong> ${torneo.ubicacion}
                        </div>
                        ${torneo.descripcion ? `<div class="torneo-info" style="margin-top: 1rem;">${torneo.descripcion}</div>` : ''}
                        <div class="price-tag">$${formatPrice(torneo.costo)}</div>

                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            <button class="btn inscribirse-btn" onclick="openModal('${torneo._id}')"
                                style="flex: 1; ${torneo.equiposInscritos.length >= torneo.numEquipos ? 'opacity: 0.5; cursor: not-allowed;' : ''}"
                                ${torneo.equiposInscritos.length >= torneo.numEquipos ? 'disabled' : ''}>
                                ${torneo.equiposInscritos.length >= torneo.numEquipos ? 'Cupos Llenos' : 'Inscribir Equipo'}
                            </button>

                            ${torneo.equiposInscritos.length > 0 ? `
                                <button class="btn" onclick="verEquipos('${torneo._id}')"
                                    style="flex: 1; background: #059669;">
                                    Ver Equipos (${torneo.equiposInscritos.length})
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
        } catch (error) {
            console.error('Error al cargar torneos:', error);
            grid.innerHTML = '<p style="color: #ef4444; text-align: center; grid-column: 1/-1;">Error al cargar los torneos. Por favor, recarga la p√°gina.</p>';
        }
    }

    // ========== MODAL DE INSCRIPCI√ìN ==========
    async function openModal(torneoId) {
        try {
            const response = await fetch(`${API_URL}/torneos/${torneoId}`);
            torneoSeleccionado = await response.json();

            document.getElementById('inscripcion-modal').style.display = 'flex';
            document.getElementById('inscripcion-form').reset();
            document.getElementById('modal-message').style.display = 'none';
        } catch (error) {
            console.error('Error al cargar torneo:', error);
            alert('Error al cargar el torneo');
        }
    }

    function closeModal() {
        document.getElementById('inscripcion-modal').style.display = 'none';
        torneoSeleccionado = null;
    }

    // ========== INSCRIBIR EQUIPO ==========
    document.getElementById('inscripcion-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (!torneoSeleccionado) return;

        const equipo = {
            nombre: document.getElementById('nombre-equipo').value,
            capitan: document.getElementById('nombre-capitan').value,
            telefono: document.getElementById('telefono').value,
            email: document.getElementById('email').value
        };

        try {
            const response = await fetch(`${API_URL}/torneos/${torneoSeleccionado._id}/equipos`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(equipo)
            });

            const data = await response.json();

            if (response.ok) {
                showMessage('modal-message', data.mensaje, 'success');

                setTimeout(() => {
                    closeModal();
                    cargarTorneos();
                    showMessage('torneos-message', `El equipo "${equipo.nombre}" ha sido inscrito en el torneo "${torneoSeleccionado.nombre}"`, 'success');
                }, 2000);
            } else {
                showMessage('modal-message', data.error || 'Error al inscribir el equipo', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showMessage('modal-message', 'Error de conexi√≥n con el servidor', 'error');
        }
    });

    // ========== VER EQUIPOS ==========
    async function verEquipos(torneoId) {
        try {
            const response = await fetch(`${API_URL}/torneos/${torneoId}/equipos`);
            const data = await response.json();

            const equiposList = document.getElementById('equipos-list');

            if (data.equipos.length === 0) {
                equiposList.innerHTML = '<p style="color: #e5e7eb; text-align: center;">No hay equipos inscritos a√∫n.</p>';
            } else {
                equiposList.innerHTML = `
                        <div style="margin-bottom: 1rem; padding: 1rem; background: #1f2937; border-radius: 8px;">
                            <h3 style="color: #10b981; margin: 0;">${data.torneo}</h3>
                            <p style="color: #9ca3af; margin: 0.5rem 0 0 0;">
                                Cupos disponibles: ${data.cuposDisponibles}
                            </p>
                        </div>
                        ${data.equipos.map((equipo, index) => `
                            <div style="padding: 1rem; background: #374151; border-radius: 8px; margin-bottom: 1rem;">
                                <h4 style="color: #10b981; margin: 0 0 0.5rem 0;">
                                    ${index + 1}. ${equipo.nombre}
                                </h4>
                                <p style="color: #e5e7eb; margin: 0.25rem 0;">
                                    <strong>Capit√°n:</strong> ${equipo.capitan}
                                </p>
                                <p style="color: #e5e7eb; margin: 0.25rem 0;">
                                    <strong>Tel√©fono:</strong> ${equipo.telefono}
                                </p>
                                <p style="color: #e5e7eb; margin: 0.25rem 0;">
                                    <strong>Email:</strong> ${equipo.email}
                                </p>
                                <p style="color: #9ca3af; margin: 0.5rem 0 0 0; font-size: 0.875rem;">
                                    Inscrito: ${formatDate(equipo.fechaInscripcion)}
                                </p>
                            </div>
                        `).join('')}
                    `;
            }

            document.getElementById('equipos-modal').style.display = 'flex';
        } catch (error) {
            console.error('Error al cargar equipos:', error);
            alert('Error al cargar los equipos');
        }
    }

    function closeEquiposModal() {
        document.getElementById('equipos-modal').style.display = 'none';
    }

    // ========== UTILIDADES ==========
    function showMessage(elementId, text, type) {
        const messageEl = document.getElementById(elementId);
        messageEl.textContent = text;
        messageEl.className = `message ${type}`;
        messageEl.style.display = 'block';

        setTimeout(() => {
            messageEl.style.display = 'none';
        }, 5000);
    }

    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('es-ES', options);
    }

    function formatPrice(price) {
        return price.toLocaleString('es-CO');
    }

    // Cerrar modales al hacer clic fuera
    window.onclick = function(event) {
        const inscripcionModal = document.getElementById('inscripcion-modal');
        const equiposModal = document.getElementById('equipos-modal');

        if (event.target === inscripcionModal) {
            closeModal();
        }
        if (event.target === equiposModal) {
            closeEquiposModal();
        }
    }

    // Cargar torneos al iniciar
    window.addEventListener('DOMContentLoaded', () => {
        console.log('‚úÖ Aplicaci√≥n cargada - API URL:', API_URL);
    });
</script>
</body>
</html>